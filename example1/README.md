

# LangGraph를 활용한 상태 관리와 대화형 시스템

LangGraph를 사용하여 상태를 관리하고 대화를 유지하는 기본적인 챗봇 시스템을 구현한다.

## LangGraph의 핵심 개념: State

LangGraph에서 가장 중요한 것은 'State(상태)' 개념이다. State는 다음 세 가지 측면에서 중요한 역할을 한다:

### 1. 상태 저장
- 각 노드가 처리한 결과나 중간 데이터를 저장한다
- 대화 이력, 계산 결과, 임시 데이터 등을 보관한다

### 2. 상태 전달
- 한 노드에서 다음 노드로 데이터를 전달하는 매개체로 사용한다
- 노드 간 정보 공유와 흐름을 관리한다

### 3. 공통 컨텍스트
- 그래프의 모든 노드가 접근할 수 있는 공유 공간을 제공한다
- TypedDict로 정의하여 타입 안정성을 보장한다

## MessagesState 활용

MessagesState는 LangGraph에서 제공하는 특별한 상태 관리 클래스다:

### 1. 기본 구조
```python
class State(MessagesState):
    counter: int  # 추가 상태를 정의할 수 있다
```

### 2. 주요 특징
- 메시지 자동 누적 기능을 제공한다
- 추가 상태를 정의하여 확장할 수 있다
- TypedDict의 모든 기능을 상속받는다

### 3. 상태 관리 방식
- messages: 자동으로 대화 이력을 관리한다
- counter와 같은 추가 상태: 수동으로 관리해야 한다
- 상태 업데이트는 명시적으로 처리해야 한다

## 메시지 기록이 안되는 문제 해결

### 1. 현재 상태 유지
```python
current_state = {
    "messages": [],
    "counter": 0
}
```

### 2. 상태 업데이트
- 새 메시지 추가 시 이전 메시지를 포함해야 한다
- current_state를 매 대화마다 업데이트해야 한다
- 전체 대화 이력을 유지해야 한다

## 구현 시 주의사항

### 1. 메시지 형식
- HumanMessage: 사용자 입력을 표현한다
- AIMessage: AI 응답을 표현한다
- 메시지는 튜플 형태 (role, content)로 관리한다

### 2. 상태 업데이트
- 메시지는 리스트 형태로 누적한다
- current_state로 전체 상태를 관리한다
- 상태 업데이트 시점을 정확히 파악해야 한다

## 학습 포인트

1. MessagesState를 통한 효율적인 메시지 관리 방법을 이해한다
2. 추가 상태 정의와 관리 방법을 학습한다
3. 상태 업데이트 메커니즘을 파악한다
4. 대화 이력 유지 방법을 익힌다
